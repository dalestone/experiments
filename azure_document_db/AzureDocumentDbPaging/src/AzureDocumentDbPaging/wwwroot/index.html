<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title></title>
</head>
<body>
    <h1>Azure Document Db Paging</h1>
    <h2>Result</h2>
    <ul id="output"></ul>
    <h2>Tokens</h2>
    <ul id="tokensOutput"></ul>
    <button id="previous">Previous</button>
    <button id="next">Next</button>
    <script>
        window.onload = function () {
            var page = 0;
            var tokens = [];

            function getItems(token, page) {
                var xhr = new XMLHttpRequest();
                xhr.open("GET", "api/items?token=" + token);
                xhr.onreadystatechange = function () {
                    if (xhr.readyState == XMLHttpRequest.DONE) {
                        var ul = document.getElementById('output');
                        var tokensOutput = document.getElementById('tokensOutput');
                        var data = JSON.parse(xhr.responseText);
                        var requestContinuation = JSON.parse(data.requestContinuation);
                        ul.innerHTML = '';
                        
                        var token_li = document.createElement('li');
                        token_li.innerHTML = requestContinuation.token;
                        tokensOutput.appendChild(token_li);

                        //if (page == 0) {
                            tokens.push(requestContinuation);
                        //}
                        
                        var items = data.result;
                        var li;

                        for (var i = 0; i < items.length; i++) {
                            li = document.createElement('li');
                            li.innerHTML = items[i].name;
                            ul.appendChild(li);
                        }
                    }
                }
                xhr.send();
            }

            getItems("");

            document.getElementById('previous').addEventListener('click', function () {
                var token = tokens[page - 1].token;
                getItems(token);
                page--;
            });

            document.getElementById('next').addEventListener('click', function () {
                var token = tokens[page].token;
                getItems(token);
                page++;
            });
        }


    </script>
</body>
</html>